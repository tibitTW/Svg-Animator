<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <style>
            * {
                padding: 0;
                margin: 0;
                user-select: none;
                box-sizing: border-box;
            }
            #main-canvas {
                margin: 50px;
                width: 500px;
                height: 500px;
                border: solid 1px black;
            }
        </style>
    </head>
    <body>
        <svg xmlns="http://www.w3.org/2000/svg" id="main-canvas" class="main-canvas"></svg>
    </body>
    <script>
        var canvas = document.querySelector('#main-canvas')
        var canvasBoundingRect = canvas.getBoundingClientRect()
        // create a node (start point and end point)
        createNode = (x, y, id, r = 2, fill = 'gray') => {
            var node = document.createElementNS('http://www.w3.org/2000/svg', 'circle')
            node.setAttribute('cx', x)
            node.setAttribute('cy', y)
            node.setAttribute('r', r)
            node.setAttribute('fill', fill)
            node.setAttribute('id', id)
            return node
        }
        createRect = (x, y, w, h, id, fill = 'none', stroke = 'black') => {
            var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect')
            rect.setAttribute('x', x)
            rect.setAttribute('y', y)
            rect.setAttribute('id', id)
            rect.setAttribute('width', w)
            rect.setAttribute('height', h)
            rect.setAttribute('fill', fill)
            rect.setAttribute('stroke', stroke)

            return rect
        }

        // check if rect is being drawed
        var drawing = false
        canvas.addEventListener('mousedown', function (e) {
            drawing = true
            document.createElementNS('http://www.w3.org/2000/svg', 'circle')
            beginX = e.pageX - canvasBoundingRect.left
            beginY = e.pageY - canvasBoundingRect.top

            currentRect = createRect(beginX, beginY, 0, 0, '1')
            startPoint = createNode(beginX, beginY, 'start-point')
            endPoint = startPoint.cloneNode()
            endPoint.setAttribute('id', 'end-point')
            canvas.appendChild(startPoint)
            canvas.appendChild(endPoint)
            canvas.appendChild(currentRect)
        })
        canvas.addEventListener('mousemove', function (e) {
            if (drawing) {
                var mX = e.pageX - canvasBoundingRect.left
                var mY = e.pageY - canvasBoundingRect.top
                endPoint.setAttribute('cx', mX)
                endPoint.setAttribute('cy', mY)
                if (mX - beginX < 0) {
                    currentRect.setAttribute('x', mX)
                }
                if (mY - beginY < 0) {
                    currentRect.setAttribute('y', mY)
                }
                currentRect.setAttribute('width', Math.abs(mX - beginX))
                currentRect.setAttribute('height', Math.abs(mY - beginY))
            }
        })
        canvas.addEventListener('mouseup', function (e) {
            drawing = false
            canvas.removeChild(startPoint)
            canvas.removeChild(endPoint)
        })
    </script>
</html>
